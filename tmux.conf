#
# 基本設定
#

# prefixキーを Ctrl + b に設定
#set-option -g prefix C-b

# prefixキーを Ctrl + a に変更
set-option -g prefix C-a
unbind-key C-b

# キーストロークのディレイを減らす
set-option -sg escape-time 1

# C-a * 2 でtmux内のプログラムに C-a を送る
bind C-a send-prefix

# Window のインデックスを 1 から始める
set-option -g base-index 1

# Pane のインデックスを 1 から始める
set-window -g pane-base-index 1

# バッファ
set-option -g history-limit 10000

# 日本語環境なら今のところ必須
set-option -g status-utf8 on
set-window-option -g utf8 on

# Xterm の Ctrl + 矢印などのキー入力を有効にする
set-window-option -g xterm-keys on

# セッション毎に保持する環境変数
set -g update-environment "DISPLAY SSH_ASKPASS SSH_AGENT_PID SSH_CONNECTION WINDOWID XAUTHORITY SSH_CLIENT"


#
# 表示設定
#

# サイズの異なる端末からアクセスしたときにリサイズ
set-window -g aggressive-resize on

# メッセージ表示時間
set-option -g display-time 2000

# 256色表示
set-option -g default-terminal "screen-256color"
#set-option -g terminal-overrides "term:colors=256"

# ステータスバーの更新間隔
set-option -g status-interval 1

# ステータスバー
set-option -g status-fg colour255
set-option -g status-bg colour237

set-window-option -g window-status-fg colour255
set-window-option -g window-status-bg colour237
set-window-option -g window-status-format " #I: #W "

set-window-option -g window-status-current-fg colour255
set-window-option -g window-status-current-bg colour64
set-window-option -g window-status-current-format " #I: #W "

# ステータスバーの左
set-option -g status-left-length 22
set-option -g status-left "#[fg=colour255,bg=colour240]#(which time-colors &> /dev/null && time-colors) %Y.%m.%d %H:%M:%S  #[default]"

# ステータスバーの右
set-option -g status-right-length 60
set-option -g status-right "#[fg=colour255,bg=colour240]#(which time-colors &> /dev/null && time-colors)  #(cut -d' ' -f-3 /proc/loadavg) "


#
# 操作設定
#

# コピーモードのキーマップ (標準はemacs)
set-window-option -g mode-keys vi

# <prefix> | で Pane を縦に分割
bind | split-window -h

# <prefix> - で Pane を横に分割
bind - split-window -v

# <prefix> space でウィンドウ一覧表示
bind Space choose-window

# マウスホイールでスクロール
set-option -g mouse on
set-option -g terminal-overrides 'xterm*:smcup@:rmcup@'
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"
bind -n WheelDownPane select-pane -t= \; send-keys -M
bind -n C-WheelUpPane select-pane -t= \; copy-mode -e \; send-keys -M
#set-window-option -g mode-mouse on
#set-option -g mouse-resize-pane on
#set-option -g mouse-select-pane on
#set-option -g mouse-select-window on

# コピーモードでカーソルを行頭/行末に移動
bind-key -t vi-copy C-a start-of-line
bind-key -n -t vi-copy C-e end-of-line

# ホイールでスクロールする幅を広く
bind -t vi-copy    C-WheelUpPane   halfpage-up
bind -t vi-copy    C-WheelDownPane halfpage-down
bind -t emacs-copy C-WheelUpPane   halfpage-up
bind -t emacs-copy C-WheelDownPane halfpage-down

# Alt + 左右矢印でウィンドウ切り替え
unbind-key M-Left
bind-key -n M-Left select-window -p
unbind-key M-Right
bind-key -n M-Right select-window -n

# <prefix> k で Window を閉じる
unbind k
bind k confirm-before "kill-window"

# <prefix> K で Pane を閉じる
unbind K
bind K kill-pane

# <prefix> C-r で設定を再読み込み
bind C-r source-file ~/.tmux.conf \; display-message "~/.tmux.conf was reloaded."

# <prefix> C-] で履歴からペースト
bind C-] choose-buffer
